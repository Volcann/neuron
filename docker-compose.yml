version: '3.8'

services:
  auth:
    image: python:3.11-slim
    command: sh -c "pip install fastapi uvicorn python-jose[cryptography] && uvicorn main:app --host 0.0.0.0 --port 8002"
    working_dir: /app
    volumes: ["./auth:/app"]
    env_file: .env
    ports: ["8002:8002"]

  inference:
    image: python:3.11-slim
    command: sh -c "pip install fastapi uvicorn pydantic && uvicorn main:app --host 0.0.0.0 --port 8001"
    working_dir: /app
    volumes: ["./inference:/app"]
    ports: ["8001:8001"]

  gateway:
    image: python:3.11-slim
    command: sh -c "pip install fastapi uvicorn httpx python-jose[cryptography] && uvicorn main:app --host 0.0.0.0 --port 8000"
    working_dir: /app
    volumes: ["./gateway:/app"]
    env_file: .env
    ports: ["8000:8000"]
    depends_on:
      - auth
      - inference
